<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><link rel="canonical" href="https://t03i.github.io/FlatProt/api/transformation/" />
      <link rel="shortcut icon" href="../../img/favicon.ico" />
    <title>Transformation & Projection - FlatProt</title>
    <link rel="stylesheet" href="../../css/theme.css" />
    <link rel="stylesheet" href="../../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
        <link href="../../assets/_mkdocstrings.css" rel="stylesheet" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "Transformation \u0026 Projection";
        var mkdocs_page_input_path = "api/transformation.md";
        var mkdocs_page_url = "/FlatProt/api/transformation/";
      </script>
    
    <!--[if lt IE 9]>
      <script src="../../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/yaml.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/python.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/json.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/toml.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/bash.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/numpy.min.js"></script>
      <script>hljs.highlightAll();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="../.." class="icon icon-home"> FlatProt
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../..">Home</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../../installation/">Installation</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../../examples/">Examples</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">Commands</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../commands/project/">Project</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../commands/align/">Align</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../commands/overlay/">Overlay</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../commands/split/">Split</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">File Formats</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../file_formats/matrix/">Matrix Files</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../file_formats/style/">Style Files</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../file_formats/annotations/">Annotation Files</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Tools</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../tools/matrix_extraction/">PyMOL Matrix Extraction</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">API Reference</span></p>
              <ul class="current">
                  <li class="toctree-l1"><a class="reference internal" href="../io/">IO</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../core/">Core</a>
                  </li>
                  <li class="toctree-l1 current"><a class="reference internal current" href="#">Transformation & Projection</a>
    <ul class="current">
    <li class="toctree-l2"><a class="reference internal" href="#transformation-matrix">Transformation Matrix</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#flatprot.transformation.TransformationMatrix">TransformationMatrix</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#flatprot.transformation.TransformationMatrix.__eq__">__eq__</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#flatprot.transformation.TransformationMatrix.__post_init__">__post_init__</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#flatprot.transformation.TransformationMatrix.after">after</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#flatprot.transformation.TransformationMatrix.apply">apply</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#flatprot.transformation.TransformationMatrix.before">before</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#flatprot.transformation.TransformationMatrix.from_array">from_array</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#flatprot.transformation.TransformationMatrix.from_string">from_string</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#flatprot.transformation.TransformationMatrix.to_array">to_array</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#inertia-based-transformation">Inertia-Based Transformation</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#flatprot.transformation.inertia_transformation.calculate_inertia_transformation_matrix">calculate_inertia_transformation_matrix</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#flatprot.transformation.inertia_transformation.InertiaTransformationParameters">InertiaTransformationParameters</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#flatprot.transformation.inertia_transformation.InertiaTransformationParameters.default">default</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#flatprot.transformation.inertia_transformation.InertiaTransformer">InertiaTransformer</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#matrix-based-transformation">Matrix-Based Transformation</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#flatprot.transformation.matrix_transformation.MatrixTransformParameters">MatrixTransformParameters</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#flatprot.transformation.matrix_transformation.MatrixTransformer">MatrixTransformer</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#flatprot.transformation.matrix_transformation.MatrixTransformer.__init__">__init__</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#structure-transformation-utilities">Structure Transformation Utilities</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#flatprot.utils.structure_utils.transform_structure_with_inertia">transform_structure_with_inertia</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#flatprot.utils.structure_utils.transform_structure_with_matrix">transform_structure_with_matrix</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#orthographic-projection">Orthographic Projection</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#flatprot.utils.structure_utils.project_structure_orthographically">project_structure_orthographically</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#domain-transformation-utilities">Domain Transformation Utilities</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#flatprot.utils.domain_utils.DomainTransformation">DomainTransformation</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#flatprot.utils.domain_utils.DomainTransformation.__post_init__">__post_init__</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#flatprot.utils.domain_utils.DomainTransformation.__repr__">__repr__</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#flatprot.utils.domain_utils.apply_domain_transformations_masked">apply_domain_transformations_masked</a>
    </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../scene/">Scene</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../rendering/">Rendering</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../alignment/">DatabaseAlignment</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../..">FlatProt</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../.." class="icon icon-home" aria-label="Docs"></a></li>
          <li class="breadcrumb-item">API Reference</li>
      <li class="breadcrumb-item active">Transformation & Projection</li>
    <li class="wy-breadcrumbs-aside">
          <a href="https://github.com/t03i/FlatProt/edit/master/docs/api/transformation.md" class="icon icon-github"> Edit on GitHub</a>
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="transformation-projection-api">Transformation &amp; Projection API</h1>
<p>This section documents functions and classes related to transforming protein structures (e.g., alignment, inertia-based) and projecting them into 2D coordinates for visualization.</p>
<h2 id="transformation-matrix">Transformation Matrix</h2>
<p>Defines the core class for handling 3D transformation matrices.</p>


<div class="doc doc-object doc-class">



<a id="flatprot.transformation.TransformationMatrix"></a>
    <div class="doc doc-contents first">


        <p>Represents a transformation matrix.</p>







              <details class="quote">
                <summary>Source code in <code>src/flatprot/transformation/transformation_matrix.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">  9</span>
<span class="normal"> 10</span>
<span class="normal"> 11</span>
<span class="normal"> 12</span>
<span class="normal"> 13</span>
<span class="normal"> 14</span>
<span class="normal"> 15</span>
<span class="normal"> 16</span>
<span class="normal"> 17</span>
<span class="normal"> 18</span>
<span class="normal"> 19</span>
<span class="normal"> 20</span>
<span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@dataclass</span>
<span class="k">class</span> <span class="nc">TransformationMatrix</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Represents a transformation matrix.&quot;&quot;&quot;</span>

    <span class="n">rotation</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span>
    <span class="n">translation</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span>

    <span class="k">def</span> <span class="nf">__post_init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Validate matrix shapes.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">rotation</span><span class="o">.</span><span class="n">shape</span> <span class="o">!=</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Rotation matrix must be 3x3&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">translation</span><span class="o">.</span><span class="n">shape</span> <span class="o">!=</span> <span class="p">(</span><span class="mi">3</span><span class="p">,):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Translation vector must have shape (3,)&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">before</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span> <span class="s2">&quot;TransformationMatrix&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;TransformationMatrix&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Combine two transformation matrices by first applying self, then other.</span>

<span class="sd">        The combined transformation T = T2 ∘ T1 is:</span>
<span class="sd">        rotation = R2 @ R1</span>
<span class="sd">        translation = R2 @ t1 + t2</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">TransformationMatrix</span><span class="p">(</span>
            <span class="n">rotation</span><span class="o">=</span><span class="n">other</span><span class="o">.</span><span class="n">rotation</span> <span class="o">@</span> <span class="bp">self</span><span class="o">.</span><span class="n">rotation</span><span class="p">,</span>
            <span class="n">translation</span><span class="o">=</span><span class="n">other</span><span class="o">.</span><span class="n">rotation</span> <span class="o">@</span> <span class="bp">self</span><span class="o">.</span><span class="n">translation</span> <span class="o">+</span> <span class="n">other</span><span class="o">.</span><span class="n">translation</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">after</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span> <span class="s2">&quot;TransformationMatrix&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;TransformationMatrix&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Combine two transformation matrices by first applying other, then self.</span>

<span class="sd">        The combined transformation T = T1 ∘ T2 is:</span>
<span class="sd">        rotation = R1 @ R2</span>
<span class="sd">        translation = R1 @ t2 + t1</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">TransformationMatrix</span><span class="p">(</span>
            <span class="n">rotation</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">rotation</span> <span class="o">@</span> <span class="n">other</span><span class="o">.</span><span class="n">rotation</span><span class="p">,</span>
            <span class="n">translation</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">rotation</span> <span class="o">@</span> <span class="n">other</span><span class="o">.</span><span class="n">translation</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">translation</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">to_array</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Convert TransformationMatrix to a single numpy array for storage.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Array of shape (4, 3) where first 3 rows are rotation matrix</span>
<span class="sd">            and last row is translation vector</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">rotation</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">translation</span><span class="p">])</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">from_array</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">arr</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;TransformationMatrix&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Create TransformationMatrix from stored array format.</span>

<span class="sd">        Args:</span>
<span class="sd">            arr: Array of shape (4, 3) where first 3 rows are rotation matrix</span>
<span class="sd">                and last row is translation vector</span>

<span class="sd">        Returns:</span>
<span class="sd">            TransformationMatrix instance</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">arr</span><span class="o">.</span><span class="n">shape</span> <span class="o">!=</span> <span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">3</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Input array must be 4x3, but got </span><span class="si">{</span><span class="n">arr</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="c1"># Original slicing for 4x3 array</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span><span class="n">rotation</span><span class="o">=</span><span class="n">arr</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span> <span class="p">:],</span> <span class="n">translation</span><span class="o">=</span><span class="n">arr</span><span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="p">:])</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">from_string</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">s</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;TransformationMatrix&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Create TransformationMatrix from string representation (assuming 4x3 layout).&quot;&quot;&quot;</span>
        <span class="c1"># Assuming the string represents a flattened 4x3 matrix</span>
        <span class="n">arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">fromstring</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s2">&quot; &quot;</span><span class="p">)</span>  <span class="c1"># Adjust separator if needed</span>
        <span class="k">if</span> <span class="n">arr</span><span class="o">.</span><span class="n">size</span> <span class="o">!=</span> <span class="mi">12</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;String must represent 12 numbers for a 4x3 matrix&quot;</span><span class="p">)</span>
        <span class="n">arr</span> <span class="o">=</span> <span class="n">arr</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="o">.</span><span class="n">from_array</span><span class="p">(</span><span class="n">arr</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">apply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">coordinates</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Apply the transformation matrix using the standard (R @ X) + T convention.</span>

<span class="sd">        Args:</span>
<span class="sd">            coordinates: Array of shape (N, 3) containing 3D coordinates.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Array of shape (N, 3) containing transformed coordinates.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">coordinates</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Input coordinates must be a numpy array.&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">coordinates</span><span class="o">.</span><span class="n">ndim</span> <span class="o">!=</span> <span class="mi">2</span> <span class="ow">or</span> <span class="n">coordinates</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">3</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Input coordinates must have shape (N, 3), got </span><span class="si">{</span><span class="n">coordinates</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>
        <span class="k">if</span> <span class="n">coordinates</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">coordinates</span>  <span class="c1"># Return empty array if input is empty</span>

        <span class="c1"># Standard application: Rotate around origin, then translate</span>
        <span class="n">rotated</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rotation</span> <span class="o">@</span> <span class="n">coordinates</span><span class="o">.</span><span class="n">T</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
        <span class="n">transformed</span> <span class="o">=</span> <span class="n">rotated</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">translation</span>
        <span class="k">return</span> <span class="n">transformed</span>

    <span class="k">def</span> <span class="fm">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span> <span class="s2">&quot;TransformationMatrix&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Check if two TransformationMatrix instances are equal.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">allclose</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rotation</span><span class="p">,</span> <span class="n">other</span><span class="o">.</span><span class="n">rotation</span><span class="p">)</span> <span class="ow">and</span> <span class="n">np</span><span class="o">.</span><span class="n">allclose</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">translation</span><span class="p">,</span> <span class="n">other</span><span class="o">.</span><span class="n">translation</span>
        <span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h2 id="flatprot.transformation.TransformationMatrix.__eq__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__eq__</span><span class="p">(</span><span class="n">other</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Check if two TransformationMatrix instances are equal.</p>


            <details class="quote">
              <summary>Source code in <code>src/flatprot/transformation/transformation_matrix.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span> <span class="s2">&quot;TransformationMatrix&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Check if two TransformationMatrix instances are equal.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">allclose</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rotation</span><span class="p">,</span> <span class="n">other</span><span class="o">.</span><span class="n">rotation</span><span class="p">)</span> <span class="ow">and</span> <span class="n">np</span><span class="o">.</span><span class="n">allclose</span><span class="p">(</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">translation</span><span class="p">,</span> <span class="n">other</span><span class="o">.</span><span class="n">translation</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="flatprot.transformation.TransformationMatrix.__post_init__" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">__post_init__</span><span class="p">()</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Validate matrix shapes.</p>


            <details class="quote">
              <summary>Source code in <code>src/flatprot/transformation/transformation_matrix.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">__post_init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Validate matrix shapes.&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">rotation</span><span class="o">.</span><span class="n">shape</span> <span class="o">!=</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Rotation matrix must be 3x3&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">translation</span><span class="o">.</span><span class="n">shape</span> <span class="o">!=</span> <span class="p">(</span><span class="mi">3</span><span class="p">,):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Translation vector must have shape (3,)&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="flatprot.transformation.TransformationMatrix.after" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">after</span><span class="p">(</span><span class="n">other</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Combine two transformation matrices by first applying other, then self.</p>
<p>The combined transformation T = T1 ∘ T2 is:
rotation = R1 @ R2
translation = R1 @ t2 + t1</p>


            <details class="quote">
              <summary>Source code in <code>src/flatprot/transformation/transformation_matrix.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">after</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span> <span class="s2">&quot;TransformationMatrix&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;TransformationMatrix&quot;</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Combine two transformation matrices by first applying other, then self.</span>

<span class="sd">    The combined transformation T = T1 ∘ T2 is:</span>
<span class="sd">    rotation = R1 @ R2</span>
<span class="sd">    translation = R1 @ t2 + t1</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">TransformationMatrix</span><span class="p">(</span>
        <span class="n">rotation</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">rotation</span> <span class="o">@</span> <span class="n">other</span><span class="o">.</span><span class="n">rotation</span><span class="p">,</span>
        <span class="n">translation</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">rotation</span> <span class="o">@</span> <span class="n">other</span><span class="o">.</span><span class="n">translation</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">translation</span><span class="p">,</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="flatprot.transformation.TransformationMatrix.apply" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">apply</span><span class="p">(</span><span class="n">coordinates</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Apply the transformation matrix using the standard (R @ X) + T convention.</p>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>coordinates</code></b>
                  (<code><span title="numpy.ndarray">ndarray</span></code>)
              –
              <div class="doc-md-description">
                <p>Array of shape (N, 3) containing 3D coordinates.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Returns:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
                  <code><span title="numpy.ndarray">ndarray</span></code>
              –
              <div class="doc-md-description">
                <p>Array of shape (N, 3) containing transformed coordinates.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

            <details class="quote">
              <summary>Source code in <code>src/flatprot/transformation/transformation_matrix.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">apply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">coordinates</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Apply the transformation matrix using the standard (R @ X) + T convention.</span>

<span class="sd">    Args:</span>
<span class="sd">        coordinates: Array of shape (N, 3) containing 3D coordinates.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Array of shape (N, 3) containing transformed coordinates.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">coordinates</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Input coordinates must be a numpy array.&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">coordinates</span><span class="o">.</span><span class="n">ndim</span> <span class="o">!=</span> <span class="mi">2</span> <span class="ow">or</span> <span class="n">coordinates</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">3</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Input coordinates must have shape (N, 3), got </span><span class="si">{</span><span class="n">coordinates</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">)</span>
    <span class="k">if</span> <span class="n">coordinates</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">coordinates</span>  <span class="c1"># Return empty array if input is empty</span>

    <span class="c1"># Standard application: Rotate around origin, then translate</span>
    <span class="n">rotated</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rotation</span> <span class="o">@</span> <span class="n">coordinates</span><span class="o">.</span><span class="n">T</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
    <span class="n">transformed</span> <span class="o">=</span> <span class="n">rotated</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">translation</span>
    <span class="k">return</span> <span class="n">transformed</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="flatprot.transformation.TransformationMatrix.before" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">before</span><span class="p">(</span><span class="n">other</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Combine two transformation matrices by first applying self, then other.</p>
<p>The combined transformation T = T2 ∘ T1 is:
rotation = R2 @ R1
translation = R2 @ t1 + t2</p>


            <details class="quote">
              <summary>Source code in <code>src/flatprot/transformation/transformation_matrix.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">before</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span> <span class="s2">&quot;TransformationMatrix&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;TransformationMatrix&quot;</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Combine two transformation matrices by first applying self, then other.</span>

<span class="sd">    The combined transformation T = T2 ∘ T1 is:</span>
<span class="sd">    rotation = R2 @ R1</span>
<span class="sd">    translation = R2 @ t1 + t2</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">TransformationMatrix</span><span class="p">(</span>
        <span class="n">rotation</span><span class="o">=</span><span class="n">other</span><span class="o">.</span><span class="n">rotation</span> <span class="o">@</span> <span class="bp">self</span><span class="o">.</span><span class="n">rotation</span><span class="p">,</span>
        <span class="n">translation</span><span class="o">=</span><span class="n">other</span><span class="o">.</span><span class="n">rotation</span> <span class="o">@</span> <span class="bp">self</span><span class="o">.</span><span class="n">translation</span> <span class="o">+</span> <span class="n">other</span><span class="o">.</span><span class="n">translation</span><span class="p">,</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="flatprot.transformation.TransformationMatrix.from_array" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">from_array</span><span class="p">(</span><span class="n">arr</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

</h2>


    <div class="doc doc-contents ">

        <p>Create TransformationMatrix from stored array format.</p>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>arr</code></b>
                  (<code><span title="numpy.ndarray">ndarray</span></code>)
              –
              <div class="doc-md-description">
                <p>Array of shape (4, 3) where first 3 rows are rotation matrix
and last row is translation vector</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Returns:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
                  <code><a class="autorefs autorefs-internal" title="flatprot.transformation.transformation_matrix.TransformationMatrix" href="#flatprot.transformation.TransformationMatrix">TransformationMatrix</a></code>
              –
              <div class="doc-md-description">
                <p>TransformationMatrix instance</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

            <details class="quote">
              <summary>Source code in <code>src/flatprot/transformation/transformation_matrix.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span> <span class="nf">from_array</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">arr</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;TransformationMatrix&quot;</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Create TransformationMatrix from stored array format.</span>

<span class="sd">    Args:</span>
<span class="sd">        arr: Array of shape (4, 3) where first 3 rows are rotation matrix</span>
<span class="sd">            and last row is translation vector</span>

<span class="sd">    Returns:</span>
<span class="sd">        TransformationMatrix instance</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">arr</span><span class="o">.</span><span class="n">shape</span> <span class="o">!=</span> <span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">3</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Input array must be 4x3, but got </span><span class="si">{</span><span class="n">arr</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="c1"># Original slicing for 4x3 array</span>
    <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span><span class="n">rotation</span><span class="o">=</span><span class="n">arr</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span> <span class="p">:],</span> <span class="n">translation</span><span class="o">=</span><span class="n">arr</span><span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="p">:])</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="flatprot.transformation.TransformationMatrix.from_string" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">from_string</span><span class="p">(</span><span class="n">s</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

</h2>


    <div class="doc doc-contents ">

        <p>Create TransformationMatrix from string representation (assuming 4x3 layout).</p>


            <details class="quote">
              <summary>Source code in <code>src/flatprot/transformation/transformation_matrix.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span> <span class="nf">from_string</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">s</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;TransformationMatrix&quot;</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Create TransformationMatrix from string representation (assuming 4x3 layout).&quot;&quot;&quot;</span>
    <span class="c1"># Assuming the string represents a flattened 4x3 matrix</span>
    <span class="n">arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">fromstring</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s2">&quot; &quot;</span><span class="p">)</span>  <span class="c1"># Adjust separator if needed</span>
    <span class="k">if</span> <span class="n">arr</span><span class="o">.</span><span class="n">size</span> <span class="o">!=</span> <span class="mi">12</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;String must represent 12 numbers for a 4x3 matrix&quot;</span><span class="p">)</span>
    <span class="n">arr</span> <span class="o">=</span> <span class="n">arr</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
    <span class="k">return</span> <span class="bp">cls</span><span class="o">.</span><span class="n">from_array</span><span class="p">(</span><span class="n">arr</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="flatprot.transformation.TransformationMatrix.to_array" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">to_array</span><span class="p">()</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Convert TransformationMatrix to a single numpy array for storage.</p>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Returns:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
                  <code><span title="numpy.ndarray">ndarray</span></code>
              –
              <div class="doc-md-description">
                <p>Array of shape (4, 3) where first 3 rows are rotation matrix</p>
              </div>
            </li>
            <li>
                  <code><span title="numpy.ndarray">ndarray</span></code>
              –
              <div class="doc-md-description">
                <p>and last row is translation vector</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

            <details class="quote">
              <summary>Source code in <code>src/flatprot/transformation/transformation_matrix.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">to_array</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Convert TransformationMatrix to a single numpy array for storage.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Array of shape (4, 3) where first 3 rows are rotation matrix</span>
<span class="sd">        and last row is translation vector</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">rotation</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">translation</span><span class="p">])</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div><p>options:
show_root_heading: true
members_order: source</p>
<h2 id="inertia-based-transformation">Inertia-Based Transformation</h2>
<p>Classes and functions for calculating and applying transformations based on the principal axes of inertia.
These transformations are often used for aligning protein structures in a way that preserves their overall shape and orientation.
Commonly these are implemented in orientation features of molecular visualization software.</p>


<div class="doc doc-object doc-function">



<a id="flatprot.transformation.inertia_transformation.calculate_inertia_transformation_matrix"></a>
    <div class="doc doc-contents first">

        <p>Calculate transformation matrix for optimal molecular orientation,
returning components compatible with standard (R @ X) + T application.</p>
<p>The transformation aligns the principal axes with the coordinate axes
and moves the center of mass/geometry C to the origin.
This function calculates R_inertia and C, then returns R_standard = R_inertia
and T_standard = -(R_inertia @ C).</p>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>coordinates</code></b>
                  (<code><span title="numpy.ndarray">ndarray</span></code>)
              –
              <div class="doc-md-description">
                <p>Nx3 array of atomic coordinates</p>
              </div>
            </li>
            <li>
              <b><code>weights</code></b>
                  (<code><span title="numpy.ndarray">ndarray</span></code>)
              –
              <div class="doc-md-description">
                <p>N-length array of weights for each coordinate</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Returns:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
                  <code><a class="autorefs autorefs-internal" title="flatprot.transformation.transformation_matrix.TransformationMatrix" href="#flatprot.transformation.TransformationMatrix">TransformationMatrix</a></code>
              –
              <div class="doc-md-description">
                <p>TransformationMatrix with rotation = R_inertia and translation = -(R_inertia @ C)</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

            <details class="quote">
              <summary>Source code in <code>src/flatprot/transformation/inertia_transformation.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">calculate_inertia_transformation_matrix</span><span class="p">(</span>
    <span class="n">coordinates</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">weights</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">TransformationMatrix</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculate transformation matrix for optimal molecular orientation,</span>
<span class="sd">    returning components compatible with standard (R @ X) + T application.</span>

<span class="sd">    The transformation aligns the principal axes with the coordinate axes</span>
<span class="sd">    and moves the center of mass/geometry C to the origin.</span>
<span class="sd">    This function calculates R_inertia and C, then returns R_standard = R_inertia</span>
<span class="sd">    and T_standard = -(R_inertia @ C).</span>

<span class="sd">    Args:</span>
<span class="sd">        coordinates: Nx3 array of atomic coordinates</span>
<span class="sd">        weights: N-length array of weights for each coordinate</span>

<span class="sd">    Returns:</span>
<span class="sd">        TransformationMatrix with rotation = R_inertia and translation = -(R_inertia @ C)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Calculate center (weighted or geometric) C</span>
    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">allclose</span><span class="p">(</span><span class="n">weights</span><span class="p">,</span> <span class="n">weights</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>  <span class="c1"># All weights equal -&gt; geometric center</span>
        <span class="n">center_C</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">coordinates</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>  <span class="c1"># Weighted center of mass</span>
        <span class="n">total_weight</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">weights</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">total_weight</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">center_C</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">coordinates</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>  <span class="c1"># Fallback for zero weights</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">center_C</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">coordinates</span> <span class="o">*</span> <span class="n">weights</span><span class="p">[:,</span> <span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="o">/</span> <span class="n">total_weight</span>
            <span class="p">)</span>

    <span class="c1"># Center coordinates for inertia tensor calculation</span>
    <span class="n">centered_coords</span> <span class="o">=</span> <span class="n">coordinates</span> <span class="o">-</span> <span class="n">center_C</span>

    <span class="c1"># Principal axis method using inertia tensor</span>
    <span class="n">inertia_tensor</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">coord</span><span class="p">,</span> <span class="n">weight</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">centered_coords</span><span class="p">,</span> <span class="n">weights</span><span class="p">):</span>
        <span class="n">r_squared</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">coord</span> <span class="o">*</span> <span class="n">coord</span><span class="p">)</span>
        <span class="n">inertia_tensor</span> <span class="o">+=</span> <span class="n">weight</span> <span class="o">*</span> <span class="p">(</span><span class="n">r_squared</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">outer</span><span class="p">(</span><span class="n">coord</span><span class="p">,</span> <span class="n">coord</span><span class="p">))</span>

    <span class="n">_</span><span class="p">,</span> <span class="n">eigenvectors</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">eigh</span><span class="p">(</span><span class="n">inertia_tensor</span><span class="p">)</span>
    <span class="c1"># Rotation matrix (R_inertia) is composed of the eigenvectors</span>
    <span class="n">rotation_R_inertia</span> <span class="o">=</span> <span class="n">eigenvectors</span>

    <span class="c1"># Ensure a right-handed coordinate system</span>
    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">det</span><span class="p">(</span><span class="n">rotation_R_inertia</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">rotation_R_inertia</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">*=</span> <span class="o">-</span><span class="mi">1</span>

    <span class="c1"># Calculate the standard translation T = -(R_inertia @ C)</span>
    <span class="c1"># Ensure C is treated as a column vector for matmul</span>
    <span class="n">center_C_col</span> <span class="o">=</span> <span class="n">center_C</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">translation_T_standard_col</span> <span class="o">=</span> <span class="o">-</span><span class="p">(</span><span class="n">rotation_R_inertia</span> <span class="o">@</span> <span class="n">center_C_col</span><span class="p">)</span>
    <span class="n">translation_T_standard</span> <span class="o">=</span> <span class="n">translation_T_standard_col</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>  <span class="c1"># Back to (3,)</span>

    <span class="c1"># Return the matrix with components for standard application</span>
    <span class="k">return</span> <span class="n">TransformationMatrix</span><span class="p">(</span>
        <span class="n">rotation</span><span class="o">=</span><span class="n">rotation_R_inertia</span><span class="p">,</span> <span class="n">translation</span><span class="o">=</span><span class="n">translation_T_standard</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div><p>options:
show_root_heading: true</p>


<div class="doc doc-object doc-class">



<a id="flatprot.transformation.inertia_transformation.InertiaTransformationParameters"></a>
    <div class="doc doc-contents first">
            <p class="doc doc-class-bases">
              Bases: <code><span title="flatprot.transformation.base_transformation.BaseTransformationParameters">BaseTransformationParameters</span></code></p>


        <p>Parameters for inertia-based projection calculation.</p>







              <details class="quote">
                <summary>Source code in <code>src/flatprot/transformation/inertia_transformation.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@dataclass</span>
<span class="k">class</span> <span class="nc">InertiaTransformationParameters</span><span class="p">(</span><span class="n">BaseTransformationParameters</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Parameters for inertia-based projection calculation.&quot;&quot;&quot;</span>

    <span class="n">residue_weights</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="n">ResidueType</span><span class="p">,</span> <span class="nb">float</span><span class="p">]</span>  <span class="c1"># Maps residue type to weight</span>
    <span class="n">use_weights</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">default</span><span class="p">(</span><span class="bp">cls</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;InertiaTransformationParameters&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Creates default parameters using standard amino acid weights.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span>
            <span class="n">residue_weights</span><span class="o">=</span><span class="p">{</span>
                <span class="n">ResidueType</span><span class="o">.</span><span class="n">ALA</span><span class="p">:</span> <span class="mf">89.1</span><span class="p">,</span>
                <span class="n">ResidueType</span><span class="o">.</span><span class="n">ARG</span><span class="p">:</span> <span class="mf">174.2</span><span class="p">,</span>
                <span class="n">ResidueType</span><span class="o">.</span><span class="n">ASN</span><span class="p">:</span> <span class="mf">132.1</span><span class="p">,</span>
                <span class="n">ResidueType</span><span class="o">.</span><span class="n">ASP</span><span class="p">:</span> <span class="mf">133.1</span><span class="p">,</span>
                <span class="n">ResidueType</span><span class="o">.</span><span class="n">CYS</span><span class="p">:</span> <span class="mf">121.2</span><span class="p">,</span>
                <span class="n">ResidueType</span><span class="o">.</span><span class="n">GLN</span><span class="p">:</span> <span class="mf">146.2</span><span class="p">,</span>
                <span class="n">ResidueType</span><span class="o">.</span><span class="n">GLU</span><span class="p">:</span> <span class="mf">147.1</span><span class="p">,</span>
                <span class="n">ResidueType</span><span class="o">.</span><span class="n">GLY</span><span class="p">:</span> <span class="mf">75.1</span><span class="p">,</span>
                <span class="n">ResidueType</span><span class="o">.</span><span class="n">HIS</span><span class="p">:</span> <span class="mf">155.2</span><span class="p">,</span>
                <span class="n">ResidueType</span><span class="o">.</span><span class="n">ILE</span><span class="p">:</span> <span class="mf">131.2</span><span class="p">,</span>
                <span class="n">ResidueType</span><span class="o">.</span><span class="n">LEU</span><span class="p">:</span> <span class="mf">131.2</span><span class="p">,</span>
                <span class="n">ResidueType</span><span class="o">.</span><span class="n">LYS</span><span class="p">:</span> <span class="mf">146.2</span><span class="p">,</span>
                <span class="n">ResidueType</span><span class="o">.</span><span class="n">MET</span><span class="p">:</span> <span class="mf">149.2</span><span class="p">,</span>
                <span class="n">ResidueType</span><span class="o">.</span><span class="n">PHE</span><span class="p">:</span> <span class="mf">165.2</span><span class="p">,</span>
                <span class="n">ResidueType</span><span class="o">.</span><span class="n">PRO</span><span class="p">:</span> <span class="mf">115.1</span><span class="p">,</span>
                <span class="n">ResidueType</span><span class="o">.</span><span class="n">SER</span><span class="p">:</span> <span class="mf">105.1</span><span class="p">,</span>
                <span class="n">ResidueType</span><span class="o">.</span><span class="n">THR</span><span class="p">:</span> <span class="mf">119.1</span><span class="p">,</span>
                <span class="n">ResidueType</span><span class="o">.</span><span class="n">TRP</span><span class="p">:</span> <span class="mf">204.2</span><span class="p">,</span>
                <span class="n">ResidueType</span><span class="o">.</span><span class="n">TYR</span><span class="p">:</span> <span class="mf">181.2</span><span class="p">,</span>
                <span class="n">ResidueType</span><span class="o">.</span><span class="n">VAL</span><span class="p">:</span> <span class="mf">117.1</span><span class="p">,</span>
            <span class="p">}</span>
        <span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h2 id="flatprot.transformation.inertia_transformation.InertiaTransformationParameters.default" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">default</span><span class="p">()</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

</h2>


    <div class="doc doc-contents ">

        <p>Creates default parameters using standard amino acid weights.</p>


            <details class="quote">
              <summary>Source code in <code>src/flatprot/transformation/inertia_transformation.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span> <span class="nf">default</span><span class="p">(</span><span class="bp">cls</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;InertiaTransformationParameters&quot;</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Creates default parameters using standard amino acid weights.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span>
        <span class="n">residue_weights</span><span class="o">=</span><span class="p">{</span>
            <span class="n">ResidueType</span><span class="o">.</span><span class="n">ALA</span><span class="p">:</span> <span class="mf">89.1</span><span class="p">,</span>
            <span class="n">ResidueType</span><span class="o">.</span><span class="n">ARG</span><span class="p">:</span> <span class="mf">174.2</span><span class="p">,</span>
            <span class="n">ResidueType</span><span class="o">.</span><span class="n">ASN</span><span class="p">:</span> <span class="mf">132.1</span><span class="p">,</span>
            <span class="n">ResidueType</span><span class="o">.</span><span class="n">ASP</span><span class="p">:</span> <span class="mf">133.1</span><span class="p">,</span>
            <span class="n">ResidueType</span><span class="o">.</span><span class="n">CYS</span><span class="p">:</span> <span class="mf">121.2</span><span class="p">,</span>
            <span class="n">ResidueType</span><span class="o">.</span><span class="n">GLN</span><span class="p">:</span> <span class="mf">146.2</span><span class="p">,</span>
            <span class="n">ResidueType</span><span class="o">.</span><span class="n">GLU</span><span class="p">:</span> <span class="mf">147.1</span><span class="p">,</span>
            <span class="n">ResidueType</span><span class="o">.</span><span class="n">GLY</span><span class="p">:</span> <span class="mf">75.1</span><span class="p">,</span>
            <span class="n">ResidueType</span><span class="o">.</span><span class="n">HIS</span><span class="p">:</span> <span class="mf">155.2</span><span class="p">,</span>
            <span class="n">ResidueType</span><span class="o">.</span><span class="n">ILE</span><span class="p">:</span> <span class="mf">131.2</span><span class="p">,</span>
            <span class="n">ResidueType</span><span class="o">.</span><span class="n">LEU</span><span class="p">:</span> <span class="mf">131.2</span><span class="p">,</span>
            <span class="n">ResidueType</span><span class="o">.</span><span class="n">LYS</span><span class="p">:</span> <span class="mf">146.2</span><span class="p">,</span>
            <span class="n">ResidueType</span><span class="o">.</span><span class="n">MET</span><span class="p">:</span> <span class="mf">149.2</span><span class="p">,</span>
            <span class="n">ResidueType</span><span class="o">.</span><span class="n">PHE</span><span class="p">:</span> <span class="mf">165.2</span><span class="p">,</span>
            <span class="n">ResidueType</span><span class="o">.</span><span class="n">PRO</span><span class="p">:</span> <span class="mf">115.1</span><span class="p">,</span>
            <span class="n">ResidueType</span><span class="o">.</span><span class="n">SER</span><span class="p">:</span> <span class="mf">105.1</span><span class="p">,</span>
            <span class="n">ResidueType</span><span class="o">.</span><span class="n">THR</span><span class="p">:</span> <span class="mf">119.1</span><span class="p">,</span>
            <span class="n">ResidueType</span><span class="o">.</span><span class="n">TRP</span><span class="p">:</span> <span class="mf">204.2</span><span class="p">,</span>
            <span class="n">ResidueType</span><span class="o">.</span><span class="n">TYR</span><span class="p">:</span> <span class="mf">181.2</span><span class="p">,</span>
            <span class="n">ResidueType</span><span class="o">.</span><span class="n">VAL</span><span class="p">:</span> <span class="mf">117.1</span><span class="p">,</span>
        <span class="p">}</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div><p>options:
show_root_heading: true
members_order: source</p>


<div class="doc doc-object doc-class">



<a id="flatprot.transformation.inertia_transformation.InertiaTransformer"></a>
    <div class="doc doc-contents first">
            <p class="doc doc-class-bases">
              Bases: <code><span title="flatprot.transformation.base_transformation.BaseTransformation">BaseTransformation</span>[<a class="autorefs autorefs-internal" title="flatprot.transformation.inertia_transformation.InertiaTransformationParameters" href="#flatprot.transformation.inertia_transformation.InertiaTransformationParameters">InertiaTransformationParameters</a>, <span title="flatprot.transformation.inertia_transformation.InertiaTransformationArguments">InertiaTransformationArguments</span>]</code></p>


        <p>Transforms using inertia-based calculation with residue weights.</p>







              <details class="quote">
                <summary>Source code in <code>src/flatprot/transformation/inertia_transformation.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">InertiaTransformer</span><span class="p">(</span>
    <span class="n">BaseTransformation</span><span class="p">[</span><span class="n">InertiaTransformationParameters</span><span class="p">,</span> <span class="n">InertiaTransformationArguments</span><span class="p">]</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Transforms using inertia-based calculation with residue weights.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parameters</span><span class="p">:</span> <span class="n">InertiaTransformationParameters</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">parameters</span><span class="o">=</span><span class="n">parameters</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_calculate_transformation_matrix</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">coordinates</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
        <span class="n">parameters</span><span class="p">:</span> <span class="n">InertiaTransformationParameters</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">TransformationMatrix</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Calculate transformation matrix for given coordinates.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">use_weights</span><span class="p">:</span>
            <span class="n">weights</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">coordinates</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Map residue types to weights using parameters.residue_weights</span>
            <span class="n">weights</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
                <span class="p">[</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">residue_weights</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">res</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>
                    <span class="k">for</span> <span class="n">res</span> <span class="ow">in</span> <span class="n">parameters</span><span class="o">.</span><span class="n">residues</span>
                <span class="p">]</span>
            <span class="p">)</span>

        <span class="k">return</span> <span class="n">calculate_inertia_transformation_matrix</span><span class="p">(</span><span class="n">coordinates</span><span class="p">,</span> <span class="n">weights</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div><p>options:
show_root_heading: true
members_order: source</p>
<h2 id="matrix-based-transformation">Matrix-Based Transformation</h2>
<p>Classes for applying a pre-defined transformation matrix.</p>


<div class="doc doc-object doc-class">



<a id="flatprot.transformation.matrix_transformation.MatrixTransformParameters"></a>
    <div class="doc doc-contents first">
            <p class="doc doc-class-bases">
              Bases: <code><span title="flatprot.transformation.base_transformation.BaseTransformationParameters">BaseTransformationParameters</span></code></p>


        <p>Parameters for matrix-based transformation.</p>







              <details class="quote">
                <summary>Source code in <code>src/flatprot/transformation/matrix_transformation.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@dataclass</span>
<span class="k">class</span> <span class="nc">MatrixTransformParameters</span><span class="p">(</span><span class="n">BaseTransformationParameters</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Parameters for matrix-based transformation.&quot;&quot;&quot;</span>

    <span class="n">matrix</span><span class="p">:</span> <span class="n">TransformationMatrix</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div><p>options:
show_root_heading: true
members_order: source</p>


<div class="doc doc-object doc-class">



<a id="flatprot.transformation.matrix_transformation.MatrixTransformer"></a>
    <div class="doc doc-contents first">
            <p class="doc doc-class-bases">
              Bases: <code><span title="flatprot.transformation.base_transformation.BaseTransformation">BaseTransformation</span>[<a class="autorefs autorefs-internal" title="flatprot.transformation.matrix_transformation.MatrixTransformParameters" href="#flatprot.transformation.matrix_transformation.MatrixTransformParameters">MatrixTransformParameters</a>, None]</code></p>


        <p>Projects coordinates using a provided rotation matrix and translation vector.</p>
<p>This projector applies a fixed projection matrix provided at initialization.</p>







              <details class="quote">
                <summary>Source code in <code>src/flatprot/transformation/matrix_transformation.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">MatrixTransformer</span><span class="p">(</span><span class="n">BaseTransformation</span><span class="p">[</span><span class="n">MatrixTransformParameters</span><span class="p">,</span> <span class="kc">None</span><span class="p">]):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Projects coordinates using a provided rotation matrix and translation vector.</span>

<span class="sd">    This projector applies a fixed projection matrix provided at initialization.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parameters</span><span class="p">:</span> <span class="n">MatrixTransformParameters</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize with a fixed transformation matrix.</span>

<span class="sd">        Args:</span>
<span class="sd">            projection_matrix: The ProjectionMatrix to use for all projections</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">parameters</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_cached_transformation</span> <span class="o">=</span> <span class="n">parameters</span><span class="o">.</span><span class="n">matrix</span>

    <span class="k">def</span> <span class="nf">_calculate_transformation_matrix</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">coordinates</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">TransformationMatrix</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return the fixed projection matrix.</span>

<span class="sd">        Since this projector uses a fixed projection matrix provided at initialization,</span>
<span class="sd">        this method simply returns the cached transformation.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cached_transformation</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h2 id="flatprot.transformation.matrix_transformation.MatrixTransformer.__init__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">parameters</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Initialize with a fixed transformation matrix.</p>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>projection_matrix</code></b>
              –
              <div class="doc-md-description">
                <p>The ProjectionMatrix to use for all projections</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

            <details class="quote">
              <summary>Source code in <code>src/flatprot/transformation/matrix_transformation.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parameters</span><span class="p">:</span> <span class="n">MatrixTransformParameters</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Initialize with a fixed transformation matrix.</span>

<span class="sd">    Args:</span>
<span class="sd">        projection_matrix: The ProjectionMatrix to use for all projections</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">parameters</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_cached_transformation</span> <span class="o">=</span> <span class="n">parameters</span><span class="o">.</span><span class="n">matrix</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div><p>options:
show_root_heading: true
members_order: source</p>
<h2 id="structure-transformation-utilities">Structure Transformation Utilities</h2>
<p>Helper functions (often used internally by CLI commands) for applying transformations to <code>flatprot.core.Structure</code> objects.</p>


<div class="doc doc-object doc-function">



<a id="flatprot.utils.structure_utils.transform_structure_with_inertia"></a>
    <div class="doc doc-contents first">

        <p>Transforms a Structure using its principal axes of inertia.</p>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>structure</code></b>
                  (<code><a class="autorefs autorefs-internal" title="flatprot.core.Structure" href="../core/#flatprot.core.Structure">Structure</a></code>)
              –
              <div class="doc-md-description">
                <p>The protein structure to transform.</p>
              </div>
            </li>
            <li>
              <b><code>custom_config_params</code></b>
                  (<code><span title="typing.Optional">Optional</span>[<a class="autorefs autorefs-internal" title="flatprot.transformation.InertiaTransformationParameters" href="#flatprot.transformation.inertia_transformation.InertiaTransformationParameters">InertiaTransformationParameters</a>]</code>, default:
                      <code>None</code>
)
              –
              <div class="doc-md-description">
                <p>Optional InertiaTransformationParameters to override defaults
                  (e.g., custom residue weights or disabling weights) passed
                  to the InertiaTransformer's initialization.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Returns:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
                  <code><a class="autorefs autorefs-internal" title="flatprot.core.Structure" href="../core/#flatprot.core.Structure">Structure</a></code>
              –
              <div class="doc-md-description">
                <p>A new Structure object with transformed coordinates oriented along principal axes.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Raises:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
                  <code><span title="flatprot.transformation.TransformationError">TransformationError</span></code>
              –
              <div class="doc-md-description">
                <p>If the structure is unsuitable for inertia calculation
                 (e.g., lacks coordinates or residues), or if the
                 transformation process fails mathematically.</p>
              </div>
            </li>
            <li>
                  <code><span title="ValueError">ValueError</span></code>
              –
              <div class="doc-md-description">
                <p>If the structure lacks coordinates or residues required for the process.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

            <details class="quote">
              <summary>Source code in <code>src/flatprot/utils/structure_utils.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">transform_structure_with_inertia</span><span class="p">(</span>
    <span class="n">structure</span><span class="p">:</span> <span class="n">Structure</span><span class="p">,</span>
    <span class="n">custom_config_params</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">InertiaTransformationParameters</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Structure</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Transforms a Structure using its principal axes of inertia.</span>

<span class="sd">    Args:</span>
<span class="sd">        structure: The protein structure to transform.</span>
<span class="sd">        custom_config_params: Optional InertiaTransformationParameters to override defaults</span>
<span class="sd">                              (e.g., custom residue weights or disabling weights) passed</span>
<span class="sd">                              to the InertiaTransformer&#39;s initialization.</span>

<span class="sd">    Returns:</span>
<span class="sd">        A new Structure object with transformed coordinates oriented along principal axes.</span>

<span class="sd">    Raises:</span>
<span class="sd">        TransformationError: If the structure is unsuitable for inertia calculation</span>
<span class="sd">                             (e.g., lacks coordinates or residues), or if the</span>
<span class="sd">                             transformation process fails mathematically.</span>
<span class="sd">        ValueError: If the structure lacks coordinates or residues required for the process.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">structure</span><span class="p">,</span> <span class="s2">&quot;coordinates&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">structure</span><span class="o">.</span><span class="n">coordinates</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Structure has no coordinates for inertia transformation.&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">structure</span><span class="p">,</span> <span class="s2">&quot;residues&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">structure</span><span class="o">.</span><span class="n">residues</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Structure has no residues for inertia transformation.&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">structure</span><span class="o">.</span><span class="n">coordinates</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;Structure coordinates are empty, returning original structure.&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">structure</span>  <span class="c1"># Return unchanged structure</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># Use provided config params or create default ones for the transformer&#39;s __init__</span>
        <span class="c1"># InertiaTransformationParameters likely holds config like residue_weights dict</span>
        <span class="n">inertia_config_parameters</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">custom_config_params</span> <span class="ow">or</span> <span class="n">InertiaTransformationParameters</span><span class="o">.</span><span class="n">default</span><span class="p">()</span>
        <span class="p">)</span>

        <span class="c1"># Instantiate the transformer with its configuration parameters</span>
        <span class="n">transformer</span> <span class="o">=</span> <span class="n">InertiaTransformer</span><span class="p">(</span><span class="n">parameters</span><span class="o">=</span><span class="n">inertia_config_parameters</span><span class="p">)</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Applying inertia transformation...&quot;</span><span class="p">)</span>

        <span class="c1"># Prepare the runtime arguments needed specifically for the transform call</span>
        <span class="c1"># InertiaTransformArguments (aliased from InertiaTransformationParameters in inertia.py)</span>
        <span class="c1"># likely holds data specific to this call, like the list of residues.</span>
        <span class="n">transform_arguments</span> <span class="o">=</span> <span class="n">InertiaTransformationArguments</span><span class="p">(</span>
            <span class="n">residues</span><span class="o">=</span><span class="n">structure</span><span class="o">.</span><span class="n">residues</span>
        <span class="p">)</span>

        <span class="c1"># Wrap the transformer&#39;s transform method</span>
        <span class="k">def</span> <span class="nf">transform_func</span><span class="p">(</span><span class="n">coords</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
            <span class="c1"># Pass coordinates and the required runtime arguments object</span>
            <span class="k">return</span> <span class="n">transformer</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">coords</span><span class="p">,</span> <span class="n">arguments</span><span class="o">=</span><span class="n">transform_arguments</span><span class="p">)</span>

        <span class="n">new_structure</span> <span class="o">=</span> <span class="n">structure</span><span class="o">.</span><span class="n">apply_vectorized_transformation</span><span class="p">(</span><span class="n">transform_func</span><span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Inertia transformation complete.&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">new_structure</span>

    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error during inertia transformation: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">exc_info</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="c1"># Re-raise as TransformationError if not already one</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">TransformationError</span><span class="p">):</span>
            <span class="k">raise</span>
        <span class="k">raise</span> <span class="n">TransformationError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Inertia transformation failed: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span> <span class="kn">from</span> <span class="nn">e</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div><p>options:
show_root_heading: true</p>


<div class="doc doc-object doc-function">



<a id="flatprot.utils.structure_utils.transform_structure_with_matrix"></a>
    <div class="doc doc-contents first">

        <p>Transforms a Structure using a matrix (loaded from path or identity).</p>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>structure</code></b>
                  (<code><a class="autorefs autorefs-internal" title="flatprot.core.Structure" href="../core/#flatprot.core.Structure">Structure</a></code>)
              –
              <div class="doc-md-description">
                <p>The protein structure to transform.</p>
              </div>
            </li>
            <li>
              <b><code>matrix_path</code></b>
                  (<code><span title="typing.Optional">Optional</span>[<span title="pathlib.Path">Path</span>]</code>, default:
                      <code>None</code>
)
              –
              <div class="doc-md-description">
                <p>Optional path to a numpy matrix file (.npy) for transformation.
         If None or loading fails gracefully, the identity matrix is used.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Returns:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
                  <code><a class="autorefs autorefs-internal" title="flatprot.core.Structure" href="../core/#flatprot.core.Structure">Structure</a></code>
              –
              <div class="doc-md-description">
                <p>A new Structure object with transformed coordinates.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Raises:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
                  <code><span title="flatprot.transformation.TransformationError">TransformationError</span></code>
              –
              <div class="doc-md-description">
                <p>If the transformation process fails unexpectedly (e.g.,
                 matrix loading error, issues during transformation math).</p>
              </div>
            </li>
            <li>
                  <code><span title="ValueError">ValueError</span></code>
              –
              <div class="doc-md-description">
                <p>If the structure lacks coordinates.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

            <details class="quote">
              <summary>Source code in <code>src/flatprot/utils/structure_utils.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">transform_structure_with_matrix</span><span class="p">(</span>
    <span class="n">structure</span><span class="p">:</span> <span class="n">Structure</span><span class="p">,</span> <span class="n">matrix_path</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Path</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Structure</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Transforms a Structure using a matrix (loaded from path or identity).</span>

<span class="sd">    Args:</span>
<span class="sd">        structure: The protein structure to transform.</span>
<span class="sd">        matrix_path: Optional path to a numpy matrix file (.npy) for transformation.</span>
<span class="sd">                     If None or loading fails gracefully, the identity matrix is used.</span>

<span class="sd">    Returns:</span>
<span class="sd">        A new Structure object with transformed coordinates.</span>

<span class="sd">    Raises:</span>
<span class="sd">        TransformationError: If the transformation process fails unexpectedly (e.g.,</span>
<span class="sd">                             matrix loading error, issues during transformation math).</span>
<span class="sd">        ValueError: If the structure lacks coordinates.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">structure</span><span class="p">,</span> <span class="s2">&quot;coordinates&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">structure</span><span class="o">.</span><span class="n">coordinates</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Structure has no coordinates to transform.&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">structure</span><span class="o">.</span><span class="n">coordinates</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;Structure coordinates are empty, returning original structure.&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">structure</span>  <span class="c1"># Return unchanged structure if no coords</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">transformation_matrix</span> <span class="o">=</span> <span class="n">_load_transformation_matrix</span><span class="p">(</span><span class="n">matrix_path</span><span class="p">)</span>
        <span class="c1"># Correctly instantiate MatrixTransformer using its parameters class</span>
        <span class="n">transformer_params</span> <span class="o">=</span> <span class="n">MatrixTransformParameters</span><span class="p">(</span><span class="n">matrix</span><span class="o">=</span><span class="n">transformation_matrix</span><span class="p">)</span>
        <span class="n">transformer</span> <span class="o">=</span> <span class="n">MatrixTransformer</span><span class="p">(</span><span class="n">parameters</span><span class="o">=</span><span class="n">transformer_params</span><span class="p">)</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Applying matrix transformation (source: </span><span class="si">{</span><span class="n">matrix_path</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="s1">&#39;Identity&#39;</span><span class="si">}</span><span class="s2">)...&quot;</span>
        <span class="p">)</span>

        <span class="n">new_structure</span> <span class="o">=</span> <span class="n">structure</span><span class="o">.</span><span class="n">apply_vectorized_transformation</span><span class="p">(</span>
            <span class="k">lambda</span> <span class="n">coords</span><span class="p">:</span> <span class="n">transformer</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">coords</span><span class="p">,</span> <span class="n">arguments</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Matrix transformation complete.&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">new_structure</span>

    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="c1"># Catch potential errors from apply_vectorized_transformation or transform_func</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error during matrix transformation: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">exc_info</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="c1"># Re-raise as TransformationError if not already (e.g. ValueError from shape mismatch)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">TransformationError</span><span class="p">):</span>
            <span class="k">raise</span>
        <span class="k">raise</span> <span class="n">TransformationError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Matrix transformation failed: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span> <span class="kn">from</span> <span class="nn">e</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div><p>options:
show_root_heading: true</p>
<h2 id="orthographic-projection">Orthographic Projection</h2>
<p>Function for projecting a transformed 3D structure onto a 2D canvas.</p>


<div class="doc doc-object doc-function">



<a id="flatprot.utils.structure_utils.project_structure_orthographically"></a>
    <div class="doc doc-contents first">

        <p>Projects the coordinates of a Structure orthographically, returning a new Structure.</p>
<p>Assumes the input structure's coordinates are already appropriately transformed
(e.g., centered and oriented via inertia or matrix transformation).
The coordinates of the returned Structure will be the projected (X, Y, Depth) values.</p>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>structure</code></b>
                  (<code><a class="autorefs autorefs-internal" title="flatprot.core.Structure" href="../core/#flatprot.core.Structure">Structure</a></code>)
              –
              <div class="doc-md-description">
                <p>The Structure object whose coordinates are to be projected.
       Assumes structure.coordinates holds the transformed 3D points.</p>
              </div>
            </li>
            <li>
              <b><code>width</code></b>
                  (<code><span title="int">int</span></code>)
              –
              <div class="doc-md-description">
                <p>The width of the target canvas in pixels.</p>
              </div>
            </li>
            <li>
              <b><code>height</code></b>
                  (<code><span title="int">int</span></code>)
              –
              <div class="doc-md-description">
                <p>The height of the target canvas in pixels.</p>
              </div>
            </li>
            <li>
              <b><code>padding_x</code></b>
                  (<code><span title="float">float</span></code>, default:
                      <code>0.05</code>
)
              –
              <div class="doc-md-description">
                <p>Horizontal padding as a fraction of the width (0 to &lt;0.5).</p>
              </div>
            </li>
            <li>
              <b><code>padding_y</code></b>
                  (<code><span title="float">float</span></code>, default:
                      <code>0.05</code>
)
              –
              <div class="doc-md-description">
                <p>Vertical padding as a fraction of the height (0 to &lt;0.5).</p>
              </div>
            </li>
            <li>
              <b><code>maintain_aspect_ratio</code></b>
                  (<code><span title="bool">bool</span></code>, default:
                      <code>True</code>
)
              –
              <div class="doc-md-description">
                <p>Whether to scale uniformly to fit while preserving
                   the structure's shape, or stretch to fill padding box.</p>
              </div>
            </li>
            <li>
              <b><code>center_projection</code></b>
                  (<code><span title="bool">bool</span></code>, default:
                      <code>True</code>
)
              –
              <div class="doc-md-description">
                <p>Whether to center the projected structure within the canvas.</p>
              </div>
            </li>
            <li>
              <b><code>view_direction</code></b>
                  (<code><span title="typing.Optional">Optional</span>[<span title="numpy.ndarray">ndarray</span>]</code>, default:
                      <code>None</code>
)
              –
              <div class="doc-md-description">
                <p>Optional (3,) numpy array for the view direction (camera looking along -view_direction).
            Defaults to [0, 0, 1] if None.</p>
              </div>
            </li>
            <li>
              <b><code>up_vector</code></b>
                  (<code><span title="typing.Optional">Optional</span>[<span title="numpy.ndarray">ndarray</span>]</code>, default:
                      <code>None</code>
)
              –
              <div class="doc-md-description">
                <p>Optional (3,) numpy array for the initial up vector.
       Defaults to [0, 1, 0] if None.</p>
              </div>
            </li>
            <li>
              <b><code>disable_scaling</code></b>
                  (<code><span title="bool">bool</span></code>, default:
                      <code>False</code>
)
              –
              <div class="doc-md-description">
                <p>If True, disables automatic scaling to fit canvas, useful for overlay
            comparisons where consistent scales are needed across different structures.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Returns:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
                  <code><a class="autorefs autorefs-internal" title="flatprot.core.Structure" href="../core/#flatprot.core.Structure">Structure</a></code>
              –
              <div class="doc-md-description">
                <p>A new Structure object where the coordinates represent the projected data:</p>
              </div>
            </li>
            <li>
                  <code><a class="autorefs autorefs-internal" title="flatprot.core.Structure" href="../core/#flatprot.core.Structure">Structure</a></code>
              –
              <div class="doc-md-description">
                <ul>
<li>Column 0: X canvas coordinate (float)</li>
</ul>
              </div>
            </li>
            <li>
                  <code><a class="autorefs autorefs-internal" title="flatprot.core.Structure" href="../core/#flatprot.core.Structure">Structure</a></code>
              –
              <div class="doc-md-description">
                <ul>
<li>Column 1: Y canvas coordinate (float)</li>
</ul>
              </div>
            </li>
            <li>
                  <code><a class="autorefs autorefs-internal" title="flatprot.core.Structure" href="../core/#flatprot.core.Structure">Structure</a></code>
              –
              <div class="doc-md-description">
                <ul>
<li>Column 2: Depth value (float, representing scaled Z for visibility/layering)</li>
</ul>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Raises:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
                  <code><span title="flatprot.projection.ProjectionError">ProjectionError</span></code>
              –
              <div class="doc-md-description">
                <p>If the projection process fails (e.g., mathematical error,
             invalid parameters).</p>
              </div>
            </li>
            <li>
                  <code><span title="ValueError">ValueError</span></code>
              –
              <div class="doc-md-description">
                <p>If the structure lacks coordinates or if vector inputs are invalid.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

            <details class="quote">
              <summary>Source code in <code>src/flatprot/utils/structure_utils.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">project_structure_orthographically</span><span class="p">(</span>
    <span class="n">structure</span><span class="p">:</span> <span class="n">Structure</span><span class="p">,</span>
    <span class="n">width</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="n">height</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="n">padding_x</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.05</span><span class="p">,</span>
    <span class="n">padding_y</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.05</span><span class="p">,</span>
    <span class="n">maintain_aspect_ratio</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">center_projection</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">view_direction</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">up_vector</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">disable_scaling</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Structure</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Projects the coordinates of a Structure orthographically, returning a new Structure.</span>

<span class="sd">    Assumes the input structure&#39;s coordinates are already appropriately transformed</span>
<span class="sd">    (e.g., centered and oriented via inertia or matrix transformation).</span>
<span class="sd">    The coordinates of the returned Structure will be the projected (X, Y, Depth) values.</span>

<span class="sd">    Args:</span>
<span class="sd">        structure: The Structure object whose coordinates are to be projected.</span>
<span class="sd">                   Assumes structure.coordinates holds the transformed 3D points.</span>
<span class="sd">        width: The width of the target canvas in pixels.</span>
<span class="sd">        height: The height of the target canvas in pixels.</span>
<span class="sd">        padding_x: Horizontal padding as a fraction of the width (0 to &lt;0.5).</span>
<span class="sd">        padding_y: Vertical padding as a fraction of the height (0 to &lt;0.5).</span>
<span class="sd">        maintain_aspect_ratio: Whether to scale uniformly to fit while preserving</span>
<span class="sd">                               the structure&#39;s shape, or stretch to fill padding box.</span>
<span class="sd">        center_projection: Whether to center the projected structure within the canvas.</span>
<span class="sd">        view_direction: Optional (3,) numpy array for the view direction (camera looking along -view_direction).</span>
<span class="sd">                        Defaults to [0, 0, 1] if None.</span>
<span class="sd">        up_vector: Optional (3,) numpy array for the initial up vector.</span>
<span class="sd">                   Defaults to [0, 1, 0] if None.</span>
<span class="sd">        disable_scaling: If True, disables automatic scaling to fit canvas, useful for overlay</span>
<span class="sd">                        comparisons where consistent scales are needed across different structures.</span>

<span class="sd">    Returns:</span>
<span class="sd">        A new Structure object where the coordinates represent the projected data:</span>
<span class="sd">        - Column 0: X canvas coordinate (float)</span>
<span class="sd">        - Column 1: Y canvas coordinate (float)</span>
<span class="sd">        - Column 2: Depth value (float, representing scaled Z for visibility/layering)</span>

<span class="sd">    Raises:</span>
<span class="sd">        ProjectionError: If the projection process fails (e.g., mathematical error,</span>
<span class="sd">                         invalid parameters).</span>
<span class="sd">        ValueError: If the structure lacks coordinates or if vector inputs are invalid.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">structure</span><span class="p">,</span> <span class="s2">&quot;coordinates&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">structure</span><span class="o">.</span><span class="n">coordinates</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Structure has no coordinates to project.&quot;</span><span class="p">)</span>

    <span class="n">coords_to_project</span> <span class="o">=</span> <span class="n">structure</span><span class="o">.</span><span class="n">coordinates</span>
    <span class="k">if</span> <span class="n">coords_to_project</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;Structure coordinates are empty. Returning original structure.&quot;</span><span class="p">)</span>
        <span class="c1"># Return original structure if no coordinates to project</span>
        <span class="k">return</span> <span class="n">structure</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">projector</span> <span class="o">=</span> <span class="n">OrthographicProjection</span><span class="p">()</span>

        <span class="c1"># Construct parameters for the projection</span>
        <span class="n">param_kwargs</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;width&quot;</span><span class="p">:</span> <span class="n">width</span><span class="p">,</span>
            <span class="s2">&quot;height&quot;</span><span class="p">:</span> <span class="n">height</span><span class="p">,</span>
            <span class="s2">&quot;padding_x&quot;</span><span class="p">:</span> <span class="n">padding_x</span><span class="p">,</span>
            <span class="s2">&quot;padding_y&quot;</span><span class="p">:</span> <span class="n">padding_y</span><span class="p">,</span>
            <span class="s2">&quot;maintain_aspect_ratio&quot;</span><span class="p">:</span> <span class="n">maintain_aspect_ratio</span><span class="p">,</span>
            <span class="s2">&quot;canvas_alignment&quot;</span><span class="p">:</span> <span class="s2">&quot;center&quot;</span> <span class="k">if</span> <span class="n">center_projection</span> <span class="k">else</span> <span class="s2">&quot;top_left&quot;</span><span class="p">,</span>
            <span class="s2">&quot;disable_scaling&quot;</span><span class="p">:</span> <span class="n">disable_scaling</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="n">view_direction</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">param_kwargs</span><span class="p">[</span><span class="s2">&quot;view_direction&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">view_direction</span>
        <span class="k">if</span> <span class="n">up_vector</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">param_kwargs</span><span class="p">[</span><span class="s2">&quot;up_vector&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">up_vector</span>

        <span class="n">projection_params</span> <span class="o">=</span> <span class="n">OrthographicProjectionParameters</span><span class="p">(</span><span class="o">**</span><span class="n">param_kwargs</span><span class="p">)</span>

        <span class="c1"># Define the transformation function that performs the projection</span>
        <span class="k">def</span> <span class="nf">projection_func</span><span class="p">(</span><span class="n">coords</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Performing orthographic projection internally...&quot;</span><span class="p">)</span>
            <span class="n">projected</span> <span class="o">=</span> <span class="n">projector</span><span class="o">.</span><span class="n">project</span><span class="p">(</span><span class="n">coords</span><span class="p">,</span> <span class="n">projection_params</span><span class="p">)</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Internal projection complete.&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">projected</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>  <span class="c1"># Ensure float32</span>

        <span class="c1"># Use apply_vectorized_transformation to create a new structure</span>
        <span class="c1"># with the projected coordinates</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Applying projection transformation to structure...&quot;</span><span class="p">)</span>
        <span class="n">projected_structure</span> <span class="o">=</span> <span class="n">structure</span><span class="o">.</span><span class="n">apply_vectorized_transformation</span><span class="p">(</span><span class="n">projection_func</span><span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Projection transformation applied.&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">projected_structure</span>

    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error during orthographic projection: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">exc_info</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="c1"># Re-raise specific errors or wrap in ProjectionError</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="p">(</span><span class="n">ProjectionError</span><span class="p">,</span> <span class="ne">ValueError</span><span class="p">)):</span>
            <span class="k">raise</span>
        <span class="k">raise</span> <span class="n">ProjectionError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Orthographic projection failed: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span> <span class="kn">from</span> <span class="nn">e</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div><p>options:
show_root_heading: true</p>
<h2 id="domain-transformation-utilities">Domain Transformation Utilities</h2>
<p>Classes and functions specifically for handling domain-based transformations.</p>


<div class="doc doc-object doc-class">



<a id="flatprot.utils.domain_utils.DomainTransformation"></a>
    <div class="doc doc-contents first">


        <p>Encapsulates a transformation matrix applied to a specific protein domain.</p>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Attributes:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>domain_range</code></b>
                  (<code><a class="autorefs autorefs-internal" title="ResidueRange


  
      dataclass
   (flatprot.core.coordinates.ResidueRange)" href="../core/#flatprot.core.coordinates.ResidueRange">ResidueRange</a></code>)
              –
              <div class="doc-md-description">
                <p>The specific residue range defining the domain.</p>
              </div>
            </li>
            <li>
              <b><code>transformation_matrix</code></b>
                  (<code><a class="autorefs autorefs-internal" title="flatprot.transformation.TransformationMatrix" href="#flatprot.transformation.TransformationMatrix">TransformationMatrix</a></code>)
              –
              <div class="doc-md-description">
                <p>The matrix used to transform this domain.</p>
              </div>
            </li>
            <li>
              <b><code>domain_id</code></b>
                  (<code><span title="typing.Optional">Optional</span>[<span title="str">str</span>]</code>)
              –
              <div class="doc-md-description">
                <p>An optional identifier for the domain (e.g., 'Domain1', 'N-term').</p>
              </div>
            </li>
            <li>
              <b><code>scop_id</code></b>
                  (<code><span title="typing.Optional">Optional</span>[<span title="str">str</span>]</code>)
              –
              <div class="doc-md-description">
                <p>An optional SCOP family identifier from alignment (e.g., '3000114').</p>
              </div>
            </li>
            <li>
              <b><code>alignment_probability</code></b>
                  (<code><span title="typing.Optional">Optional</span>[<span title="float">float</span>]</code>)
              –
              <div class="doc-md-description">
                <p>The alignment probability/quality score (0.0-1.0).</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>






              <details class="quote">
                <summary>Source code in <code>src/flatprot/utils/domain_utils.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@dataclass</span>
<span class="k">class</span> <span class="nc">DomainTransformation</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Encapsulates a transformation matrix applied to a specific protein domain.</span>

<span class="sd">    Attributes:</span>
<span class="sd">        domain_range: The specific residue range defining the domain.</span>
<span class="sd">        transformation_matrix: The matrix used to transform this domain.</span>
<span class="sd">        domain_id: An optional identifier for the domain (e.g., &#39;Domain1&#39;, &#39;N-term&#39;).</span>
<span class="sd">        scop_id: An optional SCOP family identifier from alignment (e.g., &#39;3000114&#39;).</span>
<span class="sd">        alignment_probability: The alignment probability/quality score (0.0-1.0).</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">domain_range</span><span class="p">:</span> <span class="n">ResidueRange</span>
    <span class="n">transformation_matrix</span><span class="p">:</span> <span class="n">TransformationMatrix</span>
    <span class="n">domain_id</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">scop_id</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">alignment_probability</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">__post_init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Validate inputs.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">domain_range</span><span class="p">,</span> <span class="n">ResidueRange</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;domain_range must be a ResidueRange object.&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">transformation_matrix</span><span class="p">,</span> <span class="n">TransformationMatrix</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
                <span class="s2">&quot;transformation_matrix must be a TransformationMatrix object.&quot;</span>
            <span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">domain_id</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">domain_id</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;domain_id must be a string if provided.&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">scop_id</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">scop_id</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;scop_id must be a string if provided.&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Provide a concise representation.&quot;&quot;&quot;</span>
        <span class="n">name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot; &#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">domain_id</span><span class="si">}</span><span class="s2">&#39;&quot;</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">domain_id</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;&lt;DomainTransformation</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2"> range=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">domain_range</span><span class="si">}</span><span class="s2">&gt;&quot;</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h2 id="flatprot.utils.domain_utils.DomainTransformation.__post_init__" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">__post_init__</span><span class="p">()</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Validate inputs.</p>


            <details class="quote">
              <summary>Source code in <code>src/flatprot/utils/domain_utils.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">__post_init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Validate inputs.&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">domain_range</span><span class="p">,</span> <span class="n">ResidueRange</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;domain_range must be a ResidueRange object.&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">transformation_matrix</span><span class="p">,</span> <span class="n">TransformationMatrix</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
            <span class="s2">&quot;transformation_matrix must be a TransformationMatrix object.&quot;</span>
        <span class="p">)</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">domain_id</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">domain_id</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;domain_id must be a string if provided.&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">scop_id</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">scop_id</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;scop_id must be a string if provided.&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="flatprot.utils.domain_utils.DomainTransformation.__repr__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__repr__</span><span class="p">()</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Provide a concise representation.</p>


            <details class="quote">
              <summary>Source code in <code>src/flatprot/utils/domain_utils.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Provide a concise representation.&quot;&quot;&quot;</span>
    <span class="n">name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot; &#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">domain_id</span><span class="si">}</span><span class="s2">&#39;&quot;</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">domain_id</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span>
    <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;&lt;DomainTransformation</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2"> range=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">domain_range</span><span class="si">}</span><span class="s2">&gt;&quot;</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div><p>options:
show_root_heading: true
members_order: source</p>


<div class="doc doc-object doc-function">



<a id="flatprot.utils.domain_utils.apply_domain_transformations_masked"></a>
    <div class="doc doc-contents first">

        <p>Applies specific transformation matrices to defined domains around their centers.</p>
<p>Each domain is rotated around its geometric center, preserving its position
within the global structure while optimizing its orientation for visualization.
Uses boolean masks to identify coordinates for each domain.</p>
<p>Creates a new Structure object with transformed 3D coordinates. The original
structure remains unchanged.</p>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>structure</code></b>
                  (<code><a class="autorefs autorefs-internal" title="flatprot.core.Structure" href="../core/#flatprot.core.Structure">Structure</a></code>)
              –
              <div class="doc-md-description">
                <p>The original Structure object.</p>
              </div>
            </li>
            <li>
              <b><code>domain_transforms</code></b>
                  (<code><span title="typing.List">List</span>[<a class="autorefs autorefs-internal" title="flatprot.utils.domain_utils.DomainTransformation" href="#flatprot.utils.domain_utils.DomainTransformation">DomainTransformation</a>]</code>)
              –
              <div class="doc-md-description">
                <p>An ordered list of DomainTransformation objects.
               Rotations are applied around each domain's center.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Returns:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
                  <code><a class="autorefs autorefs-internal" title="flatprot.core.Structure" href="../core/#flatprot.core.Structure">Structure</a></code>
              –
              <div class="doc-md-description">
                <p>A new Structure object with coordinates transformed domain-specifically.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Raises:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
                  <code><span title="flatprot.transformation.TransformationError">TransformationError</span></code>
              –
              <div class="doc-md-description">
                <p>If matrix application fails.</p>
              </div>
            </li>
            <li>
                  <code><span title="ValueError">ValueError</span></code>
              –
              <div class="doc-md-description">
                <p>If structure lacks coordinates or if coordinates are not 3D.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

            <details class="quote">
              <summary>Source code in <code>src/flatprot/utils/domain_utils.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">apply_domain_transformations_masked</span><span class="p">(</span>
    <span class="n">structure</span><span class="p">:</span> <span class="n">Structure</span><span class="p">,</span>
    <span class="n">domain_transforms</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">DomainTransformation</span><span class="p">],</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Structure</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Applies specific transformation matrices to defined domains around their centers.</span>

<span class="sd">    Each domain is rotated around its geometric center, preserving its position</span>
<span class="sd">    within the global structure while optimizing its orientation for visualization.</span>
<span class="sd">    Uses boolean masks to identify coordinates for each domain.</span>

<span class="sd">    Creates a new Structure object with transformed 3D coordinates. The original</span>
<span class="sd">    structure remains unchanged.</span>

<span class="sd">    Args:</span>
<span class="sd">        structure: The original Structure object.</span>
<span class="sd">        domain_transforms: An ordered list of DomainTransformation objects.</span>
<span class="sd">                           Rotations are applied around each domain&#39;s center.</span>

<span class="sd">    Returns:</span>
<span class="sd">        A new Structure object with coordinates transformed domain-specifically.</span>

<span class="sd">    Raises:</span>
<span class="sd">        TransformationError: If matrix application fails.</span>
<span class="sd">        ValueError: If structure lacks coordinates or if coordinates are not 3D.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">structure</span><span class="p">,</span> <span class="s2">&quot;coordinates&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">structure</span><span class="o">.</span><span class="n">coordinates</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Structure has no coordinates to transform.&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">structure</span><span class="o">.</span><span class="n">coordinates</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">3</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Expected 3D coordinates, but got shape </span><span class="si">{</span><span class="n">structure</span><span class="o">.</span><span class="n">coordinates</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">)</span>

    <span class="n">original_coords</span> <span class="o">=</span> <span class="n">structure</span><span class="o">.</span><span class="n">coordinates</span>
    <span class="n">num_atoms</span> <span class="o">=</span> <span class="n">original_coords</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

    <span class="c1"># 1. Create Transformation Masks (one per domain)</span>
    <span class="n">domain_masks</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">num_atoms</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">bool</span><span class="p">)</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">domain_transforms</span>
    <span class="p">]</span>

    <span class="c1"># 2. &amp; 3. Iterate through structure coords and populate masks</span>
    <span class="k">for</span> <span class="n">chain</span> <span class="ow">in</span> <span class="n">structure</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
        <span class="k">for</span> <span class="n">residue</span> <span class="ow">in</span> <span class="n">chain</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">domain_idx</span><span class="p">,</span> <span class="n">domain_tf</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">domain_transforms</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">residue</span> <span class="ow">in</span> <span class="n">domain_tf</span><span class="o">.</span><span class="n">domain_range</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">residue</span><span class="o">.</span><span class="n">coordinate_index</span> <span class="o">&lt;</span> <span class="n">domain_masks</span><span class="p">[</span><span class="n">domain_idx</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
                        <span class="n">domain_masks</span><span class="p">[</span><span class="n">domain_idx</span><span class="p">][</span><span class="n">residue</span><span class="o">.</span><span class="n">coordinate_index</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="n">transformed_coords</span> <span class="o">=</span> <span class="n">original_coords</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

    <span class="k">for</span> <span class="n">mask</span><span class="p">,</span> <span class="n">domain_tf</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">domain_masks</span><span class="p">,</span> <span class="n">domain_transforms</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">mask</span><span class="p">):</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;No coordinates found for domain </span><span class="si">{</span><span class="n">domain_tf</span><span class="o">.</span><span class="n">domain_range</span><span class="si">}</span><span class="s2">. Skipping transformation.&quot;</span>
            <span class="p">)</span>
            <span class="k">continue</span>

        <span class="n">domain_id_str</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot; &#39;</span><span class="si">{</span><span class="n">domain_tf</span><span class="o">.</span><span class="n">domain_id</span><span class="si">}</span><span class="s2">&#39;&quot;</span> <span class="k">if</span> <span class="n">domain_tf</span><span class="o">.</span><span class="n">domain_id</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Applying centered transformation for domain</span><span class="si">{</span><span class="n">domain_id_str</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">domain_tf</span><span class="o">.</span><span class="n">domain_range</span><span class="si">}</span><span class="s2"> (affecting </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">mask</span><span class="p">)</span><span class="si">}</span><span class="s2"> coordinates)...&quot;</span>
        <span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># Calculate domain center</span>
            <span class="n">domain_center</span> <span class="o">=</span> <span class="n">calculate_domain_center</span><span class="p">(</span><span class="n">structure</span><span class="p">,</span> <span class="n">domain_tf</span><span class="o">.</span><span class="n">domain_range</span><span class="p">)</span>

            <span class="c1"># Create centered transformation using only rotation from domain_tf</span>
            <span class="c1"># This rotates the domain around its center, preserving its position</span>
            <span class="n">rotation</span> <span class="o">=</span> <span class="n">domain_tf</span><span class="o">.</span><span class="n">transformation_matrix</span><span class="o">.</span><span class="n">rotation</span>
            <span class="n">centered_matrix</span> <span class="o">=</span> <span class="n">create_centered_transformation</span><span class="p">(</span><span class="n">rotation</span><span class="p">,</span> <span class="n">domain_center</span><span class="p">)</span>

            <span class="c1"># Apply transformation to the *original* coordinates selected by the mask</span>
            <span class="n">coords_subset</span> <span class="o">=</span> <span class="n">original_coords</span><span class="p">[</span><span class="n">mask</span><span class="p">,</span> <span class="p">:]</span>
            <span class="n">transformed_subset</span> <span class="o">=</span> <span class="n">centered_matrix</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">coords_subset</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">transformed_subset</span><span class="o">.</span><span class="n">shape</span> <span class="o">!=</span> <span class="n">coords_subset</span><span class="o">.</span><span class="n">shape</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">TransformationError</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Transformation resulted in unexpected shape change for domain </span><span class="si">{</span><span class="n">domain_tf</span><span class="o">.</span><span class="n">domain_range</span><span class="si">}</span><span class="s2">. &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;Input shape: </span><span class="si">{</span><span class="n">coords_subset</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s2">, Output shape: </span><span class="si">{</span><span class="n">transformed_subset</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="p">)</span>

            <span class="n">transformed_coords</span><span class="p">[</span><span class="n">mask</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">transformed_subset</span>

            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Applied centered rotation for domain</span><span class="si">{</span><span class="n">domain_id_str</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">domain_tf</span><span class="o">.</span><span class="n">domain_range</span><span class="si">}</span><span class="s2"> &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;around center </span><span class="si">{</span><span class="n">domain_center</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">TransformationError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Failed to apply centered transformation for domain </span><span class="si">{</span><span class="n">domain_tf</span><span class="o">.</span><span class="n">domain_range</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span> <span class="kn">from</span> <span class="nn">e</span>

    <span class="c1"># Create a new structure object with the same topology but new coordinates</span>

    <span class="n">new_structure</span> <span class="o">=</span> <span class="n">structure</span><span class="o">.</span><span class="n">with_coordinates</span><span class="p">(</span><span class="n">transformed_coords</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">new_structure</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div><p>options:
show_root_heading: true</p>
              
            </div>
          </div><footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="Footer Navigation">
        <a href="../core/" class="btn btn-neutral float-left" title="Core"><span class="icon icon-circle-arrow-left"></span> Previous</a>
        <a href="../scene/" class="btn btn-neutral float-right" title="Scene">Next <span class="icon icon-circle-arrow-right"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
        <span>
          <a href="https://github.com/t03i/FlatProt" class="fa fa-github" style="color: #fcfcfc"> GitHub</a>
        </span>
    
    
      <span><a href="../core/" style="color: #fcfcfc">&laquo; Previous</a></span>
    
    
      <span><a href="../scene/" style="color: #fcfcfc">Next &raquo;</a></span>
    
  </span>
</div>
    <script src="../../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "../..";</script>
    <script src="../../js/theme_extra.js"></script>
    <script src="../../js/theme.js"></script>
      <script src="../../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
